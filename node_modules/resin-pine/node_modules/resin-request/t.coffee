settings = require('resin-settings-client')
url = require('url')
fs = require('fs')
request = require('./lib/request')

imageMakerUrl = settings.get('imageMakerUrl')

deviceType = 'parallella'

request.stream
	method: 'GET'
	url: url.resolve(imageMakerUrl, "/api/v1/image/#{deviceType}/")
.then (stream) ->
	stream.on 'progress', (state) ->
		console.log(state)

	stream.pipe(fs.createWriteStream('/Users/jviotti/Desktop/rpi.img'))
